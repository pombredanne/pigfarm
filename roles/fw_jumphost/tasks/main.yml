---
- name: Include group secrets for fw_jumphost
  include_vars: secrets/group_vars/all.yml
  tags: fw

- name: Check if there are any hosts secrets
  stat: path="secrets/host_vars/{{ ansible_hostname  }}.yml"
  register: host_secrets_exist
  tags: fw

- name: Include host secrets
  include_vars: "secrets/host_vars/{{ ansible_hostname }}.yml"
  when: host_secrets_exist.stat.exists == True
  tags: fw


- name: Upload ssh configuration/chains
  template:
    src: ssh.ferm.conf.j2
    dest: /etc/ferm/rules.d/ssh.ferm.conf
    owner: root
    group: root
    mode: 0660
  notify:
    - reload ferm
  tags: fw

- name: Upload forwarding configuration/chains
  template:
    src: forwarding.ferm.conf.j2
    dest: /etc/ferm/rules.d/forwarding.ferm.conf
    owner: root
    group: root
    mode: 0660
  notify:
    - reload ferm
  tags: fw
