---
- name: Install vagrant packages (Fedora)
  action:
    module: "{{ ansible_pkg_mgr }}"
    name: "{{ item }}"
    state: present
  with_items:
    - vagrant
  when: ansible_distribution == 'Fedora'

- name: Install vagrant packages (CentOS)
  action:
    module: "{{ ansible_pkg_mgr }}"
    name: "{{ vagrant_download_url_rpm }}"
    state: present
  when: ansible_distribution == 'CentOS'

- name: Install auxilary packages (RedHat)
  action:
    module: "{{ ansible_pkg_mgr }}"
    name: "{{ item }}"
    state: present
  with_items:
    - libvirt-devel
    - ruby-devel
    - gcc
    - gcc-c++
    - zlib
    - zlib-devel
    - rubygem-builder
    - rubygem-diff-lcs
    - rubygem-excon
    - rubygem-fog-core
    - rubygem-formatador
    - rubygem-multi_json
    - rubygem-rake
    - rubygem-rspec2
    - rubygem-rspec2-core
    - rubygem-rspec2-expectations
    - rubygem-rspec2-mocks
    - rubygem-ruby-libvirt
    - redhat-rpm-config

#http://serverfault.com/questions/733319/ansible-enable-repo-and-add-pgp-key-on-centos-7
- name: install virtualbox repository key (redhat)
  copy:
    src: oracle_vbox.asc
    dest: /etc/pki/rpm-gpg/rpm-gpg-key-oracle-vbox
    owner: root
    group: root
    mode: 0644
  when: ansible_os_family == 'RedHat'

- name: Install virtualbox repository (RedHat)
  copy:
    src: "virtualbox.{{ ansible_distribution }}.repo"
    dest: /etc/yum.repos.d/virtualbox.repo
  when: ansible_os_family == 'RedHat'

- name: Install virtualbox packages
  action:
    module: "{{ ansible_pkg_mgr }}"
    name: "{{ item }}"
    state: present
  with_items:
    - dkms
    - VirtualBox-5.0
